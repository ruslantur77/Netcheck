# Netcheck agent

Асинхронный агент для проверки доступности сайтов и хостов. 
Использует RabbitMQ для получения запросов на проверку и возврата результата.

## Функционал

- Регистрация в бекенде по API токену
- Работа с полученными credentials от rabbitmq
- heartbeat с настраиваемым интервалом
- PING, HTTP, TCP запросы, DNS резолвинг

## Запуск


### Конфигурация

Для корректного запуска необходимо в файле `.env` указать переменные окружения.

Пример файла - `.env.example`

| Название           | Пример значения                               | Описание                           |
| ------------------ | --------------------------------------------- | ---------------------------------- |
| LOG_LEVEL          | INFO                                          | Уровень логирования                |
| REGISTRATION_TOKEN | 584d0da0-aa12-4f5c-8c53-a3fbd109a586          | API токен с бекенда                |
| REGISTRATION_URL   | http://172.17.0.1:8000/api/v1/agents/register | URL эндпоинта для регистрации      |
| GET_IP_API_URL     | https://api.ipify.org                         | Сервис для получения публичного IP |
| REGION             | RU                                            | Регион для отображения в UI        |
| NUM_WORKERS        | 5                                             | Число параллельных запросов        |


Для регистрации агента необходимо создать агента на сайте в панели управления агентами, получить API ключ для регистрации, установить его в в переменную `REGISTRATION_TOKEN`.

Для корректного определения публичного IP необходим сервис, который возвращает строку IP в ответ на GET запрос. `https://api.ipify.org` как пример.



### Docker

Используется сборка с несколькими stage для уменьшения веса итогового образа.

Для сборки выполнить:

```bash
docker build . -t "netcheck-agent"
```

Для запуска:

```bash
docker run -d --name agent --env-file .env netcheck-agent:latest
```


### Локальный запуск

#### UV (рекомендуется)

Необходим установленный [UV](https://docs.astral.sh/uv/)

Для запуска при помощи UV необходимо выполнить:

```bash
uv sync

uv run -m netcheck_agent.main
```

#### pip

Необходимо создать виртуальное окружение:

```bash
python -m venv .venv
source .venv/bin/activate
```

Далее установить пакет в editable mode:

```bash
pip install -e .
```

Запустить:

```bash
python -m netcheck_agent.main
```



