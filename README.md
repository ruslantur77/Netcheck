# Netcheck

Сервис для проверки доступности сайтов, IP и хостов.

Использует асинхронную обработку событий при помощи RabbitMQ и независимых агентов.
Реализует базовые проверки: HTTP, TCP, PING, DNS резолвинг


## Стек

- ReactJS

- Python 3.12
- FastAPI
- aiohttp
- PostgreSQL
- SQLAlchemy
- Alembic
- Redis
- RabbitMQ (aio-pika)

## Функционал

Веб интерфейс:
- Определение IP хоста
- Визуализация местоположения geoip хоста на карте
- Удобный интерфейс для PING, HTTP, TCP, DNS проверок
- Панель управления агентами для администратора
- Аутентификация при помощи JWT, автоматическое обновление токенов


Бекенд:
- Создание запроса на проверку сайта
- API для управления агентами
- Динамическое управление учетными данными rabbitmq, создание пользователей, очередей, прав доступа для агентов
- Хранение heartbeat и информации об агентах
- Управление JWT токенами 


Агент:
- Регистрация в бекенде по API токену
- Работа с полученными credentials от rabbitmq
- heartbeat с настраиваемым интервалом
- PING, HTTP, TCP запросы, DNS резолвинг


## Схема коммуникации бекенда и агентов

![alt text](https://gist.githubusercontent.com/imbalet/977e5cef0a2bdcfdbe37649993ccc433/raw/605cfd20c320c013350a9bbebb76488044278158/aeza_schema.svg)

При создании агента бекенд создает API токен и учетные данные в rabbitmq c ограниченными правами для подключения. При регистрации, агент отправляет токен, указанный администратором в переменных окружения, на бекенд через REST HTTP запрос. При наличии токена в базе, бекенд отдает агенту данные для подключения, URL эндпоинта для heartbeat пакетов и тайминг. Агент подключается к очереди и готов получать запросы на проверку. 

При запросе на проверку, бекенд публикует его в обменник типа fanout, из которого запрос рассылается в очереди всех агентов. После выполнения проверки, ответы приходят в очередь для ответов и бекенд собирает их, сохраняя в базе данных.

Есть возможность мгновенного удаления агента и всех учетных данных, при этом агент моментально лишается возможность читать и отправлять сообщения в очередь.